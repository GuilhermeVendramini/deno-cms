<%- await include(`${Deno.cwd()}${Deno.env.get('THEME')}templates/layout/header.ejs`, { title: 'Content' }) %>
<% if (currentUser) { %>
  <%- await include(`${Deno.cwd()}${Deno.env.get('THEME')}templates/menus/adminMenu.ejs`, { currentUser: currentUser}) %>
<% } %>
<div class="container h-100 pt-4">
  <h1 class="text-center mb-3">Content</h1>
  <fieldset class="border p-2">
    <legend  class="w-auto">Add</legend>
    <div class="d-flex mb-3">
      <div class="mr-2">
        <a href="/admin/content/basic-page/add" class="btn btn-outline-secondary">Basic page</a>
      </div>
      <div class="mr-2">
        <a href="/admin/content/article/add" class="btn btn-outline-secondary">Article</a>
      </div>
      <div class="mr-2">
        <a href="#" class="btn btn-outline-secondary">Landing page</a>
      </div>
    </div>
  </fieldset>
  <div class="mt-3">
    <% if (content) { %>
    <table class="table">
      <thead>
        <tr>
          <th scope="col">ID</th>
          <th scope="col">Title</th>
          <th scope="col">Type</th>
          <th scope="col">Author</th>
          <th scope="col">Created</th>
          <th scope="col">Updated</th>
          <th scope="col">Published</th>
          <th scope="col">Operations</th>
        </tr>
      </thead>
      <tbody>
        <% for(var i=0; i < content.length; i++) { %>
        <tr>
          <th scope="row"><%= content[i]._id.$oid %></th>
          <td><a href='/<%= content[i].type.replace("_", "-") %>/<%= content[i]._id.$oid %>'><%= content[i].data.title %></a></td>
          <td><%= content[i].type %></td>
          <td><%= content[i].author.name %></td>
          <td><%= content[i].created %></td>
          <td><%= content[i].updated %></td>
          <td><%= content[i].published %></td>
          <td>
            <% if (currentUser._id.$oid == content[i].author._id.$oid || currentUser.roles.includes(0)) { %>
              <a href='/admin/content/<%= content[i].type.replace("_", "-") %>/edit/<%= content[i]._id.$oid %>'>edit</a> | <a href='/admin/content/<%= content[i].type.replace("_", "-") %>/delete/<%= content[i]._id.$oid %>'>delete</a>
            <% } %>
          </td>
        </tr>
        <% } %>
      </tbody>
    </table>
    <% } %>
  </div>
</div>
<%- await include(`${Deno.cwd()}${Deno.env.get('THEME')}templates/layout/footer.ejs`) %>